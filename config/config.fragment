# Extra kernel configuration options. This will be merged into the main kernel
# config (`defconfig` or `gki_defconfig`). This config should work for Linux and
# ACK, for both x86_64 and arm64. If an option doesn't exist for particular
# platform, it's automatically removed.

# Make debugging and testing easier
CONFIG_FRAME_POINTER=y
CONFIG_DEBUG_INFO_DWARF5=y
CONFIG_DEBUG_INFO_BTF=y
#CONFIG_DEBUG_INFO=y
#CONFIG_GDB_SCRIPTS=y
CONFIG_DEBUG_FS=y
CONFIG_KGDB=y
CONFIG_KGDB_KDB=y
CONFIG_KDB_KEYBOARD=y
CONFIG_DEBUG_KERNEL=y
CONFIG_DEBUG_WX=y
CONFIG_PTDUMP_DEBUGFS=y
CONFIG_IKCONFIG=y
CONFIG_IKCONFIG_PROC=y
# CONFIG_STRICT_DEVMEM is not set
CONFIG_VT=y
CONFIG_SECURITY_SELINUX=y
CONFIG_SECURITY_SELINUX_BOOTPARAM=y
CONFIG_MODULE_FORCE_LOAD=y

# LTO is required for CFI, but even LTO_CLANG_THIN is incredibly slow. Only
# enable this if it's necessary
# CONFIG_LTO_CLANG_FULL is not set
# CONFIG_LTO_CLANG_THIN=y
# CONFIG_CFI_PERMISSIVE=y

# Shared directories
CONFIG_9P_FS=y
CONFIG_NET_9P=y
CONFIG_NET_9P_VIRTIO=y

# Other virtio configuration
CONFIG_VIRTIO_BLK=y
CONFIG_VIRTIO_BALLOON=y
CONFIG_VIRTIO_CONSOLE=y
CONFIG_VIRTIO_DMA_SHARED_BUFFER=y
CONFIG_VIRTIO_INPUT=y
CONFIG_VIRTIO_NET=y
CONFIG_VIRTIO_PCI=y
CONFIG_VIRTIO_PMEM=y
CONFIG_VIRTIO_VSOCKETS=y

# devtmpfs needs to be mounted on boot for Android
CONFIG_DEVTMPFS=y
CONFIG_DEVTMPFS_MOUNT=y
# CONFIG_KASAN is not set

# Dynamic Tracing (http://events17.linuxfoundation.org/sites/events/files/slides/ELC_2017_NA_dynamic_tracing_tools_on_arm_aarch64_platform.pdf slide 40)
CONFIG_BPF=y
CONFIG_BPF_JIT=y
CONFIG_BPF_SYSCALL=y
CONFIG_BPF_EVENTS=y
CONFIG_KPROBES=y
CONFIG_KPROBE_EVENTS=y
CONFIG_UPROBES=y
CONFIG_UPROBE_EVENTS=y
CONFIG_BRANCH_PROFILE_NONE=y
CONFIG_CONTEXT_SWITCH_TRACER=y
CONFIG_DYNAMIC_FTRACE=y
CONFIG_EVENT_TRACING=y
CONFIG_FTRACE=y
CONFIG_FTRACE_MCOUNT_RECORD=y
CONFIG_FTRACE_SYSCALLS=y
CONFIG_FUNCTION_GRAPH_TRACER=y
CONFIG_FUNCTION_PROFILER=y
CONFIG_FUNCTION_TRACER=y
CONFIG_BOOTTIME_TRACING=y
CONFIG_GENERIC_TRACER=y
CONFIG_NOP_TRACER=y
CONFIG_PREEMPT_TRACER=y
CONFIG_RELAY=y
CONFIG_RING_BUFFER=y
CONFIG_RING_BUFFER_ALLOW_SWAP=y
CONFIG_SCHED_TRACER=y
CONFIG_STACKTRACE=y
CONFIG_STACK_TRACER=y
CONFIG_TRACEPOINTS=y
CONFIG_TRACER_MAX_TRACE=y
CONFIG_TRACER_SNAPSHOT=y
CONFIG_TRACER_SNAPSHOT_PER_CPU_SWAP=y
CONFIG_TRACE_CLOCK=y
CONFIG_TRACING=y
# Mount tracefs at /sys/kernel/debug/tracing in addition to /sys/kernel/tracing.
# Some tools still require the older debugfs path
# CONFIG_TRACEFS_DISABLE_AUTOMOUNT is not set

# Allow lvl5 paging
CONFIG_X86_5LEVEL=y

# Some ACK kernels set this to zero. Technically we don't need it because we
# also set it in the kernel command line, but it helps if someone wants to use
# our prebuilt kernels and run them manually
CONFIG_SERIAL_8250_RUNTIME_UARTS=4
