#!/bin/bash

set -o errexit

CWD=$(dirname -- "$0")
ROOT_DIR="$(realpath ${CWD}/..)"

NAME="${1:-jammy}"
ARCH="${2:-x86_64}"
ORIG_ARCH="$ARCH"

DIR="${ROOT_DIR}/rootfs/ubuntu-${NAME}-${ORIG_ARCH}"

if [[ "$ARCH" == x86_64 ]]; then
    ARCH=amd64
elif [[ "$ARCH" != arm64 ]]; then
    echo "usage: $0 [NAME] [x86_64 | arm64]"
    exit 1
fi

mkdir -p $DIR
sudo debootstrap --arch $ARCH $NAME $DIR

echo "Ubuntu ${NAME} debootstrap installed in ${DIR}"
