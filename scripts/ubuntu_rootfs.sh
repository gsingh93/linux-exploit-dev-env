#!/bin/bash

set -o errexit

CWD=$(dirname -- "$0")
ROOT_DIR="$(realpath ${CWD}/..)"

version="${1:-22.04}"
arch="${2:-x86_64}"
orig_arch="$arch"

if [[ "$arch" == x86_64 ]]; then
    arch=amd64
elif [[ "$arch" != arm64 ]]; then
    echo "usage: $0 VERSION [x86_64 | arm64]"
    exit 1
fi

URL="https://cdimage.ubuntu.com/ubuntu-base/releases/${version}/release"
FILEPATH="${ROOT_DIR}/rootfs/ubuntu-base-${version}-base-${arch}.tar.gz"
DIR="${ROOT_DIR}/rootfs/ubuntu-${version}-${orig_arch}"

wget --no-verbose --show-progress "$URL/ubuntu-base-${version}-base-${arch}.tar.gz" -O "$FILEPATH"
mkdir -p "$DIR"
tar -xf "$FILEPATH" -C "$DIR"

echo "Ubuntu ${version} rootfs extracted to ${DIR}"
